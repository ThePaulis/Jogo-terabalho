<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 1</title>
    <script src=https://cdnjs.cloudflare.com/ajax/libs/phaser/3.55.2/phaser.min.js integrity="sha512-kg6fSrg6FkD9Ua02PzuA289KatVkTp6HdiFrSKwnz1bKBeKe5JG54rNeYZeghYO/I4ka49rb9H/9Ezcq9Se3iQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

    var config = {
        type: Phaser.AUTO,
        width: 960,
        height: 480,
        physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 300 },
            debug: false
        }
    },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };
    var speed = 100;
    var scale = 1;
    var P_size = 48 * scale;
    var x = 9;
    var y = 23;
    var i = 0;
    var cursors;
    var player;
    
    var walls;
    var gameOver = false;
    var game = new Phaser.Game(config);
    var attack = false;
    var specialAttack = false;
    var hp = 10;
    var atk = 1;
    var score = 0;
    var scorechest = 0;
    var scoreText;
    var special = 0;
    var specialText;

    function preload ()
    {
        this.load.image('background', 'assets/background4b.png');
        this.load.spritesheet('guy',  'assets/characters/player.png', { frameWidth: 48, frameHeight: 48 });
        this.load.image('wallup', 'assets/tilesets/walls/wall1.png');
        this.load.image('wallside', 'assets/tilesets/walls/wall2.png');
        this.load.image('wallback', 'assets/tilesets/walls/wall3.png');
        this.load.image('slime', 'assets/characters/2slime.png'); 
        this.load.image('labwall', 'assets/wall_mid.png');
        this.load.spritesheet('special', 'assets/special.png',{ frameWidth: 960, frameHeight: 480 });
        this.load.image('chest', 'assets/chest.png');

    }

    function create ()
    {
        this.add.image(480,240,'background');
        walls = this.physics.add.staticGroup();

        //wall up//
        walls.create(25,21,'wallup');
        walls.create(70,21,'wallup');
        walls.create(115,21,'wallup');
        walls.create(160,21,'wallup');
        walls.create(160,21,'wallup');
        walls.create(205,21,'wallup');
        walls.create(250,21,'wallup');
        walls.create(295,21,'wallup');
        walls.create(340,21,'wallup');
        walls.create(385,21,'wallup');
        walls.create(430,21,'wallup');
        walls.create(475,21,'wallup');
        walls.create(520,21,'wallup');
        walls.create(565,21,'wallup');
        walls.create(610,21,'wallup');
        walls.create(655,21,'wallup');
        walls.create(700,21,'wallup');
        walls.create(745,21,'wallup');
        walls.create(790,21,'wallup');
        walls.create(835,21,'wallup');
        walls.create(880,21,'wallup');
        walls.create(925,21,'wallup');
        walls.create(990,21,'wallup');

        //Wall side left//
        
        for (let i = 0; i < 80; i++) {
  walls.create(9, 23 + (6 * i),'wallside');
}
         

         //Wall side left//
         for (let i = 0; i < 80; i++) {
             walls.create(950, 15 + (6 * i),'wallside');
         }



         for (let i = 0; i < 46; i++) {
             walls.create(-11 + (21 * i), 470 ,'wallback');
         }
    












         
        player = this.physics.add.sprite(0, 500, 'guy');

        player.setCollideWorldBounds(true);

        chests = this.physics.add.group();
        
        enemies= this.physics.add.group();

        var enemie = enemies.create(300,00,'slime');
        
        

        enemie.setCollideWorldBounds(true);
        enemie.setVelocity(Phaser.Math.Between(100, 200), 50);
        enemie.allowGravity = false;

        


        this.anims.create({
        key: 'face down',
        frames: [ { key: 'guy', frame: 0 } ],
        frameRate: 20,
       
    });

    this.anims.create({
        key: 'right',
        frames: this.anims.generateFrameNumbers('guy', { start: 6, end: 11 }),
        frameRate: 20,
        repeat: -1
    });

    
    this.anims.create({
        key: 'up',
        frames: this.anims.generateFrameNumbers('guy', {start: 12, end: 17}),
        frameRate: 20,
        repeat: -1
    });


    this.anims.create({
        key: 'down',
        frames: this.anims.generateFrameNumbers('guy', {start: 18, end: 23}),
        frameRate: 20,
        repeat: -1
    });

    this.anims.create({
        key: 'left',
        frames: this.anims.generateFrameNumbers('guy', {start: 11, end: 6}),
        frameRate: 20,
        repeat: -1
    });

    this.anims.create({
        key: 'atackR',
        frames: [ { key: 'guy', frame: 43 } ],
        frameRate: 10,
        
    });
   
    this.anims.create({
        key: 'special',
        frames: this.anims.generateFrameNumbers('special', {start: 0, end: 12}),
        frameRate: 10,
        repeat: -1
        
    });

     

    



   
    cursors = this.input.keyboard.createCursorKeys();
    this.physics.add.collider(player, walls);
    this.physics.add.collider(enemies, walls);
    this.physics.add.collider(enemie, walls);

    
   
var chest = chests.create(920,40,'chest');
chest.setCollideWorldBounds(true);
        chest.setVelocity(0,0);
        chest.allowGravity = true;
    this.physics.add.collider(player, chests);
    this.physics.add.collider(chests, walls);
    this.physics.add.collider(chest, walls);
    this.physics.add.collider(enemies, chests);
    this.physics.add.collider(enemie, chests);
    chest.disableBody(true,true);
 
        
   
    this.physics.add.collider(player, chests, hitchest, null, this);  
 
    

    this.physics.add.collider(player, enemies, hitenemie, null, this);  
     
   
    
    scoreText = this.add.text(32, 32, 'score: 0', { fontSize: '32px', fill: '#001' });


    specialText = this.add.text(600, 32, 'Special: 0%', { fontSize: '32px', fill: '#001' });



    }

    function update ()
    {
        if (gameOver)
    {
        return;
    }


        if (cursors.right.isDown)
    {
        player.setVelocityX(200);

        player.anims.play('right', true);
        attack=false;
        specialAttack=false;

    }
    
     else if (cursors.up.isDown)
    {
        player.setVelocityY(-200);

        player.anims.play('up', true);
        attack=false;
        
    }        

    else if(cursors.down.isDown)
    {
        player.setVelocityY(200);

        player.anims.play('down', true);
        attack=false;
        specialAttack=false;

    }
    else if(cursors.left.isDown)
    {
        player.setVelocityX(-200);

        player.anims.play('left', true);
        attack=false;
        specialAttack=false;

    }
    else if(cursors.space.isDown)
    {
        player.setVelocityX(50);
        player.anims.play('atackR', true);
        attack=true;

        specialAttack=false;
    }
    else if(cursors.shift.isDown && special >= 10)
    {
       
        player.anims.play('special', true);
        specialAttack=true;
        attack=false;
        special = special - 1;
        
        specialText.setText('special : %'+ special);
   
    }
    
   
        else {
            player.setVelocity(0);
            
            player.anims.play('face down', true);
            attack=false;
        }

   
    }


    function hitenemie (player, enemie,chest)
{

   
    if(attack == true){

        hp=hp-atk;
        
        if(hp==0){
            
       enemie.disableBody(true,true);
        score += 10;
        special += 10;
        scorechest += 10;
    scoreText.setText('Score: ' + score);
    specialText.setText('special : %'+ special);
        hp =3;
        }
        if(scorechest == 150){

            var chest = chests.create(920,40,'chest');

}
        
        if (enemies.countActive(true) === 0)
    {
        var x = (player.x < 400) ? Phaser.Math.Between(400, 800) : Phaser.Math.Between(0, 400);   
        

        var i =1;
            
            enemie = enemies.create(x,500,'slime');
           
            
            enemie.setBounce(1);

        enemie.setCollideWorldBounds(true);
        enemie.setVelocity(Phaser.Math.Between(100, 200), 50);

      

    }
    
    }
      else{
    this.physics.pause();

    player.anims.play('face down');

    gameOver = true;
    }
    
}


function hitchest (player, chest)
{

   if(attack == true){
    
    chest.disableBody(true,true);
   }
    
}










</script>

</body>
</html>